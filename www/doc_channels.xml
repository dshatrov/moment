<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mync SYSTEM "entities.dtd">

<moment>
<moment_docpage/>
<content>
  <title>
    Управление каналами
  </title>

  <p>
    Создавать, удалять и изменять настройки каналов без перезапуска сервера
    можно с помощью конфигурационных файлов в специальной директории,
    которая далее условно называется <i>conf.d</i>.
    Путь к этой директории задаётся параметром <b>moment/confd_dir</b>.
  </p>
  <p>
    Каждый файл в директории <i>conf.d</i> описывает один канал.
    Название файла совпадает с названием канала.
    Файлы содержат список параметров, таких же как параметры каналов в секции
    <b>mod_gst/streams</b>. Пример содержимого такого файла:
  </p>
<pre>
chain = "videotestsrc ! x264enc ! fakesink name=video sync=true"
no_audio = y
</pre>
  <p>
    Для добавления, изменения или удаления канала без перезапуска сервера
    нужно сначала отредактировать конфигурационный файл этого канала
    в директории <i>conf.d</i>,
    затем выполнить административный HTTP-запрос на обновление настроек канала.
    Запрос имеет вид
    <i>/admin/reload_channel?conf_file=streamname</i>, где <i>streamname</i> &mdash;
    название канала. Пример:
  </p>
<pre>
http://localhost:8082/admin/reload_channel?conf_file=cam1
</pre>
  <p>
    Чтобы добавить новый канал, нужно создать для этого канала новый конфигурационный
    файл и выполнить HTTP-запрос на обновление. Для удаления канала нужно удалить
    конфигурационный файл и выполнить такой же запрос.
  </p>
  <p>
    При любом изменении настроек канала сервер выполнит повторное подключение
    к источнику аудио/видеоданных.
  </p>
  <p>
    Список доступных каналов в формате json можно получить с помощью HTTP-запроса
    вида <i>/server/playlist.json</i>. Пример запроса:
  </p>
<pre>
http://localhost:8080/server/playlist.json
</pre>
  <p>
    Пример ответа сервера:
  </p>
<pre>
 [ [ "cam1", "rtmp://144.76.27.83:1936/live/cam1", "Камера 1" ], ]
 [ [ "cam2", "rtmp://144.76.27.83:1936/live/cam2", "Камера 2" ], ]
</pre>

</content>
</moment>

